name: Tag push
description: Move a tag to HEAD and push it to the remote after a successful deploy
author: Terje Sandstrom
branding:
  icon: tag
  color: green

inputs:
  tag:
    description: Tag name to move and push (e.g., last-deploy)
    required: true
    default: last-deploy
  remote:
    description: Git remote name
    default: origin

runs:
  using: composite
  steps:
    - shell: bash
      run: |
        set -euo pipefail
        tag="${{ inputs.tag }}"
        remote="${{ inputs.remote }}"
        echo "ðŸ·ï¸ Moving '$tag' to HEAD and pushing to '$remote'â€¦"
        git fetch --tags --force >/dev/null 2>&1 || true
        git tag -f "$tag"
        git push -f "$remote" "refs/tags/$tag"
        {
          echo "### Tag push"
          echo "- Tag moved: \`$tag\`"
          echo "- Remote: \`$remote\`"
          echo "- Ref: \`$(git rev-parse --short HEAD)\`"
        } >> "$GITHUB_STEP_SUMMARY"
